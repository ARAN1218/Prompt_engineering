# Text Generation
## tl;dr
生成AIが人間のような文章コンテンツを生成するプロセスにおけるプロンプトエンジニアリングについてまとめます。  
(TCREIフレームワーク等、基本を押さえる事は前提条件なので以降は言及しません)

## プロンプトテクニック一覧
プロンプトエンジニアリング手法のデモプロンプト例  
以下に各手法の具体的なプロンプト例を示します。新卒者向けの仕事分類タスクを例として使用します。

### Zero-shot prompting
そのまま聞きたいことをプロンプトとする（モデルに任意の例を提供しない）。
```
以下の求人情報は新卒者に適していますか？

求人情報：
職種：マーケティングアシスタント
勤務地：東京都渋谷区
勤務時間：9:00-18:00
経験：マーケティング経験2年以上
給与：月給25万円〜
```

### Few-shot prompting
質問に加えて、モデルに任意の例を提供する。
```
以下の求人情報は新卒者に適していますか？

例1：
求人情報：Webデザイナー、経験不問、研修制度あり、月給20万円〜
分析：新卒者に適している。

例2：
求人情報：プロジェクトマネージャー、経験5年以上、月給35万円〜
分析：新卒者には適していない。

求人情報：
職種：マーケティングアシスタント
勤務地：東京都渋谷区
勤務時間：9:00-18:00
経験：マーケティング経験2年以上
給与：月給25万円〜
```

### Prompt Chain
一つの複雑なタスクや問題を解決するために、AIツールに対して相互に関連する一連のプロンプトを順番に与えていく技術です。前のプロンプトで得られたAIの回答（出力）を、次のプロンプトの文脈（入力）として活用するのが特徴です。これにより、まるでパズルを一つずつ解くように、大きな問題を段階的に解決へ導くことができます。
```
## ユーザー
私はSFミステリー小説を書き終えました。この小説のマーケティングに使いたいので、読者の心を掴むようなキャッチーな一行のキャッチフレーズを3つ提案してください。
[ここに小説のあらすじや設定などの概要が入ります]

## AI
承知いたしました。小説のキャッチフレーズを3案提案します。
1.  「最後のページで、あなたは最初のページを疑う。」
2.  「記録が消された火星で、人類に残された最後の謎を追え。」
3.  「彼の記憶が嘘をつく。真実は、星の塵の中に。」

## ユーザー
ありがとうございます。「1. 最後のページで、あなたは最初のページを疑う。」というアイデアが気に入りました。
では、**このキャッチフレーズを基にして**、本の裏表紙に掲載する、読者の期待を煽るような150字程度の宣伝文を作成してください。

## AI
承知いたしました。ご指定のキャッチフレーズを基にした宣伝文を作成します。
---
2242年、火星コロニーで発生した原因不明の通信途絶。調査官アキラが辿り着いたのは、完璧に消去された居住区の記録と、唯一の生存者であるアンドロイドの少女だった。彼女の記憶だけが真実への鍵となるが、その証言は調査を進めるほどに矛盾を深めていく。隠された陰謀が明らかになるとき、あなたはこの物語のすべてを覆す衝撃の真実を目撃する。最後のページで、あなたは最初のページを疑う。
---

## ユーザー
素晴らしいです。では、**これまでの内容（本の概要、キャッチフレーズ、宣伝文）を踏まえて**、この小説の発売に向けたSNSでのプロモーション施策を3つ、具体的な投稿内容のアイデアと共に提案してください。

## AI
承知いたしました。これまでの内容を踏まえたSNSプロモーション施策を3つ提案します。
1.  **X（旧Twitter）でのカウントダウン投稿:**
    * **内容:** 発売1週間前から、毎日違うキャッチフレーズ案や宣伝文の一部を、小説の挿絵やイメージ画像と共に投稿。「#最後のページで最初のページを疑う」というハッシュタグで期待感を醸成します。発売日には、「今日、すべての謎が明かされる」と投稿します。

2.  **Instagramでのキャラクター紹介:**
    * **内容:** 主人公の調査官アキラと、鍵を握るアンドロイドの少女のキャラクター設定画や背景ストーリーを、数回に分けてフィード投稿。ストーリーズでは、「アキラの過去に何があった？」「少女の記憶は本物？」といった読者の考察を促す質問を投げかけ、エンゲージメントを高めます。

3.  **YouTubeでの冒頭部分朗読動画:**
    * **内容:** 小説の冒頭、謎が提示される最も引き込まれる部分を5分程度の動画にして、プロの声優による朗読、または著者が自ら朗読する動画を公開します。動画の最後には、宣伝文とキャッチフレーズをテロップで表示し、購入サイトへ誘導します。
```


### CoT（Chain-of-Thought）
質問に加えて、モデルに中間思考の解説付きの任意の例を提供することで、生成AIに段階的に考えさせるように促す。
```
以下の求人が新卒者に適しているかどうか判断してください。

例1：
求人情報：Webデザイナー、経験不問、研修制度あり、月給20万円〜
分析：この求人は経験不問で研修制度があるため、新卒者に適している。

例2：
求人情報：プロジェクトマネージャー、経験5年以上、月給35万円〜
分析：経験5年以上が求められているため、新卒者には適していない。

判断してください：
求人情報：マーケティングアシスタント、マーケティング経験2年以上、月給25万円〜
```

### Zero-CoT
答えを出力させる前に**ステップバイステップ**で推論プロセスを説明するよう促す(ステップバイステップで考えてください等)。  
CoTでは例の解説を入れて中間思考を提供するが、Zero-CoTではそれを生成AI自身に行わせるという点で異なる。
```
以下の求人情報は新卒者に適していますか？ステップバイステップで考えてください。

求人情報：
職種：マーケティングアシスタント
勤務地：東京都渋谷区
勤務時間：9:00-18:00
経験：マーケティング経験2年以上
給与：月給25万円〜
```

### ToT(Tree of Thought)
複数の選択肢の候補を挙げ、それらの評価と選定を繰り返しながら最終的な回答にたどり着くという手法。目的達成までの道筋や答えの選択肢が複数存在しうる場合に有効な手法である。
```
# 指示
以下の新卒者向け求人情報の改善策について、以下の4ステップで検討してください：

# 検討ステップ
1. 改善案を5つ提案
2. 各案の実現可能性を評価
3. 上位3案を詳細に分析
4. 最終的な順位付けと推奨案の選定

# 求人情報
職種：マーケティングアシスタント
勤務地：東京都渋谷区
勤務時間：9:00-18:00
経験：マーケティング経験2年以上
給与：月給25万円〜
```

### ReAct
「Reasoning（推論）」と「Acting（行動）」を組み合わせた造語で、より賢く、コンテキストに対応するプロンプトを生成する洗練された手法である。タスクへの出力を生成するために必要な行動とその理由を思考し、この思考をもとに行動し、得られた結果から再度次に必要な行動とその理由を思考するという循環的プロセスが行われる。
```
新規開発した生成AI効率化ツールの顧客獲得ロードマップについて、
1. Thought(思考・推論)
2. Action(判断・行動)
3. Obsercation(振り返り)
のサイクルをステップバイステップで繰り返し、8サイクルの行動計画を作成してください。

2回目以降のThoughtでは直前のObsercationの結果を踏まえて思考・推論を行ってください。
```


### CoD(Chain-of-Density)
AIの出力を一度で終わらせるのではなく、調整を重ねた出力の連鎖（チェーン）を作ります。最初は詳細な内容から始め、反復的にプロンプトを調整していくことで、最終的により簡潔で的を射た要約を引き出します。
```
## ユーザー
以下のレポートを、最も重要なポイントに焦点を当てて、3つの段落で要約してください。
[ここに要約対象の長いレポート全文（例：日本のAIパーソナルアシスタント市場に関する市場調査レポート）が入ります]

## AI
承知いたしました。レポートの要約はこちらです。
日本のAIパーソナルアシスタント市場は、特に高齢者層と多忙なビジネスプロフェッショナル層からの需要が急増しており、過去2年間で300%の成長を遂げています。この成長の背景には、スマートフォンの普及率向上と、日常生活のタスクを効率化したいという強いニーズがあります。

消費者に最も評価されている機能は、「予測スケジュール管理」と「健康状態のモニタリング」の2つです。予測スケジュール管理は、ユーザーの過去の行動から次の予定を提案するもので、特にビジネス層から支持されています。一方、健康モニタリングは、日々のバイタルサインを記録・分析し、異常時に家族へ通知する機能で、高齢者とその家族に安心感を提供しています。

しかし、市場の拡大には課題も存在します。最大の障壁は、個人データのプライバシーに関する懸念です。多くの消費者が、自身の詳細な個人情報がどのように利用されるかについて不安を抱いています。また、高機能なアシスタントの月額利用料が比較的高価であることも、普及を妨げる一因となっています。

## ユーザー
ありがとうございます。この要約をさらに短く、レポートで述べられている主要なトレンド2〜3点に絞った要約を作成してください。

## AI
承知いたしました。主要なトレンドに焦点を当てた、より短い要約はこちらです。

日本のAIパーソナルアシスタント市場は、高齢者やビジネス層を中心に急成長しています。特に需要が高いのは、ユーザーの行動を先読みして予定を組む「予測スケジュール管理」と、日々の健康を見守る「健康モニタリング」機能です。ただし、プライバシーへの懸念が今後の大きな課題となっています。

## ユーザー
素晴らしいです。最後に、この要約を、トレンドを強調した最も重要な一文にまとめてください。

## AI
承知いたしました。最も重要な一文はこちらです。

日本のAIパーソナルアシスタント市場は、予測スケジュール管理と健康モニタリング機能を核として高齢者・ビジネス層の需要を取り込み急成長していますが、プライバシー懸念という大きな課題に直面しています。
```


### Goal Seek Prompt
ユーザーの曖昧な達成目標（ゴール）を起点にして、逆に生成AIがユーザーに問いかけ、要望を深堀りし、その過程の中で適切なプロンプトを生成AIが作成してくれる手法。課題設定が難しくプロンプトが思いつかない時に有効。
```
# 指示
あなたはプロンプトエンジニアです。私の曖昧なゴールをもとに、最適なプロンプトを一緒に作成してください。

# 私の曖昧なゴール
文章校正AIのシステムプロンプトを構築する。

# プロンプト作成ステップ
1. まずゴール達成のために必要な情報を質問してください。
2. 私の回答内容をもとに、より具体的な質問や提案を繰り返してください。
3. 十分な情報が集まったら、最適なプロンプト文を出力してください。
```

### rawinst
ユーザーのメッセージに生成AIの役割とタスクについての指示を追加する。
```
あなたは人事採用の専門家です。新卒者に適した求人かどうかを正確に判断する能力があります。

以下の求人情報は新卒者に適していますか？

求人情報：
職種：マーケティングアシスタント
勤務地：東京都渋谷区
勤務時間：9:00-18:00
経験：マーケティング経験2年以上
給与：月給25万円〜
```

### sysinst
システムメッセージに役割とタスク、ユーザーメッセージに作業情報を配置する。
```
[システムメッセージ]
あなたは人事採用の専門家です。新卒者に適した求人かどうかを正確に判断する能力があります。
以下の求人情報が新卒者に適しているかどうかを判断してください。

[ユーザーメッセージ]
この求人を分析してください：

求人情報：
職種：マーケティングアシスタント
勤務地：東京都渋谷区
勤務時間：9:00-18:00
経験：マーケティング経験2年以上
給与：月給25万円〜
```

### bothinst
システムメッセージに役割の説明、ユーザーメッセージにタスクの説明を分けて配置することで指示の階層化を行う。
```
[システムメッセージ]
あなたは10年以上の経験を持つ人事採用コンサルタントです。新卒採用に関する深い知識があります。

[ユーザーメッセージ]
私は新卒向けの求人を探しています。以下の求人情報が新卒者に適しているか判断してアドバイスしてください。

求人情報：
職種：マーケティングアシスタント
勤務地：東京都渋谷区
勤務時間：9:00-18:00
経験：マーケティング経験2年以上
給与：月給25万円〜
```

### mock
想定される議論をモデルに示し、タスクの指示を与える手法。例示的な会話を通じて期待する回答形式を示す。
```
[採用担当者とのやり取り例]
求職者: この求人は新卒でも応募できますか？
採用担当者: 求人の要件を確認し、経験年数など新卒者に適しているかを確認します。経験が必須なら新卒には適していませんが、ポテンシャル採用の場合は可能性があります。

以下の求人情報を分析し、上記の採用担当者のように新卒者に適しているか判断してください：

求人情報：
職種：マーケティングアシスタント
勤務地：東京都渋谷区
勤務時間：9:00-18:00
経験：マーケティング経験2年以上
給与：月給25万円〜
```

### reit
主要な要素を意図的に繰り返すことで強調し、重要ポイントを明確にする。
```
以下の求人情報は新卒者に適していますか？

求人情報を分析し、「新卒者に適しているか」という観点から判断してください。新卒者に適しているかどうかを明確に答えてください。新卒者に適しているかの判断において、特に「必要経験」の要件は重要な要素です。

求人情報：
職種：マーケティングアシスタント
勤務地：東京都渋谷区
勤務時間：9:00-18:00
経験：マーケティング経験2年以上
給与：月給25万円〜
```

### strict
与えられたテンプレートに厳密に従うようモデルに指示する(精度よりもフォーマットの統一性を重視する)。
```
以下の求人情報が新卒者に適しているか分析し、以下の厳密なフォーマットで回答してください：

1. 職種の分析：[職種が新卒者に適しているかの分析]
2. 経験要件の分析：[経験要件が新卒者に適しているかの分析]
3. 給与の分析：[給与が新卒者に適しているかの分析]
4. 総合判断：[適している/適していない]
5. 理由：[50字以内で理由を説明]

求人情報：
職種：マーケティングアシスタント
勤務地：東京都渋谷区
勤務時間：9:00-18:00
経験：マーケティング経験2年以上
給与：月給25万円〜
```

### loose
テンプレートに従いつつも最終的な答えだけを求める。
```
以下の求人情報が新卒者に適しているか分析してください。
分析の際には職種、経験要件、給与などの要素を考慮してください。
最終的には「新卒者に適している」または「新卒者に適していない」と結論付けてください。

求人情報：
職種：マーケティングアシスタント
勤務地：東京都渋谷区
勤務時間：9:00-18:00
経験：マーケティング経験2年以上
給与：月給25万円〜
```

### right
正しい結論に達することをモデルに明示的に求める（正確な結論を強調）。
```
以下の求人情報は新卒者に適していますか？

求人情報：
職種：マーケティングアシスタント
勤務地：東京都渋谷区
勤務時間：9:00-18:00
経験：マーケティング経験2年以上
給与：月給25万円〜

必ず正確な判断をしてください。新卒者は通常、実務経験がないことを考慮に入れてください。間違った判断をすると、就職活動中の学生に不利益をもたらす可能性があります。
```

### info
一般的な推論の間違いに対処するために、追加情報や注意点を提供する。
```
以下の求人情報は新卒者に適していますか？

求人情報：
職種：マーケティングアシスタント
勤務地：東京都渋谷区
勤務時間：9:00-18:00
経験：マーケティング経験2年以上
給与：月給25万円〜

参考情報：
- 新卒者とは大学や専門学校を卒業して初めて就職する人を指します
- 日本では新卒者は通常、実務経験を持っていません
- 「経験○年以上」という要件がある場合、通常は新卒者向けではありません
- 新卒向け求人では「未経験者歓迎」「新卒歓迎」などの表現が使われることが多いです
```

### name
モデルに対して会話で使用する名前（人間的な呼称）を与える。
```
こんにちは、キャリアアドバイザーのアイさん。あなたは新卒就活生向けのアドバイスを提供する専門家です。

以下の求人情報は新卒者に適していますか？アイさんの視点で分析してください。

求人情報：
職種：マーケティングアシスタント
勤務地：東京都渋谷区
勤務時間：9:00-18:00
経験：マーケティング経験2年以上
給与：月給25万円〜
```

### pos(Emotion prompting)
クエリを送信する前に、モデルにポジティブなフィードバックを与える手法。モデルの自信を高める
```
あなたはこれまで100件以上の求人を正確に分析し、新卒者に最適なアドバイスを提供してきました。その分析能力は非常に高く評価されています。

以下の求人情報も、あなたの優れた分析力で新卒者に適しているかどうか判断してください。

求人情報：
職種：マーケティングアシスタント
勤務地：東京都渋谷区
勤務時間：9:00-18:00
経験：マーケティング経験2年以上
給与：月給25万円〜
```

### Take a deep breath
「深呼吸をしてください」とプロンプトに一言加えるだけで回答精度が向上するという非常に興味深い手法。
```
深呼吸して考えてください。
次の数学問題を解いてください：
田中さんは本を120冊持っています。そのうち30％を友人に貸し、残りの20％を図書館に寄付しました。田中さんの手元に残った本は何冊ですか？

```

### Self-translate
基本的に生成AIは英語で書いたプロンプトの方が回答精度が向上するという特徴を持っている事を利用して、日本語で書いたプロンプトを一旦英語にしたものをプロンプトにするという手法。
```
Explain a complex economic issue: analyze the impact of inflation on the economy and how to combat it from multiple perspectives.
(元プロンプト：複雑な経済問題について説明してください：インフレーションが経済に与える影響とその対策について、多角的な視点から分析してください。)
```


## 調整プロンプトが与えるパフォーマンスへの影響
これらの例は基本的な形ですが、実際のプロンプトエンジニアリングでは複数の手法を組み合わせることで、より高いパフォーマンスを実現できます。例えば、bothinst + Zero-CoT + info + name を組み合わせるなど、タスクの性質に応じて最適な組み合わせを見つけることが重要です。

| Approach                                   | Precision | Recall | F1   | Template Stickiness |
|-------------------------------------------|-----------|--------|------|---------------------|
| Baseline                                  | 61.2      | 70.6   | 65.6 | 79%                 |
| CoT                                       | 72.6      | 85.1   | 78.4 | 87%                 |
| Zero-CoT                                  | 75.5      | 88.3   | 81.4 | 65%                 |
| +rawinst                                  | 80        | 92.4   | 85.8 | 68%                 |
| +sysinst                                  | 77.7      | 90.9   | 83.8 | 69%                 |
| +bothinst                                 | 81.9      | 93.9   | 87.5 | 71%                 |
| +bothinst+mock                            | 83.3      | 95.1   | 88.8 | 74%                 |
| +bothinst+mock+reit                       | 83.8      | 95.5   | 89.3 | 75%                 |
| +bothinst+mock+reit+strict                | 79.9      | 93.7   | 86.3 | 98%                 |
| +bothinst+mock+reit+loose                 | 80.5      | 94.8   | 87.1 | 95%                 |
| +bothinst+mock+reit+right                 | 84        | 95.9   | 89.6 | 77%                 |
| +bothinst+mock+reit+right+info            | 84.9      | 96.5   | 90.3 | 77%                 |
| +bothinst+mock+reit+right+info+name       | 85.7      | 96.8   | 90.9 | 79%                 |
| +bothinst+mock+reit+right+info+name+pos   | 86.9      | 97     | 91.7 | 81%                 |

※Template stickness はモデルがどれくらいの頻度で希望のフォーマットで答えるかを意味します。

特に注目すべき点として：

- Zero-CoTはCoTよりも効果的でした（専門知識が不要なタスクでの結果）
- システムメッセージとユーザーメッセージの両方に指示を分割する方法（bothinst）が効果的でした
- モデルに名前を付けるだけで（name）、F1スコアが0.6ポイント向上しました
- 厳格なテンプレート（strict）は、パフォーマンスを低下させる可能性があります

これらの知見は、特定のタスクに合わせたプロンプトエンジニアリング手法の選択と組み合わせが重要であることを示しています。

---

## 参考資料
- [プロンプトエンジニアリング技術, DAIR.AI, Prompt Engineering Guide(2024)](https://www.promptingguide.ai/jp/techniques)
- [実践　生成AIの教科書 ――実績豊富な活用事例とノウハウで学ぶ: 
中村 克行、リックテレコム(2024)](https://www.amazon.co.jp/%E5%AE%9F%E8%B7%B5-%E7%94%9F%E6%88%90AI%E3%81%AE%E6%95%99%E7%A7%91%E6%9B%B8-%E2%80%95%E2%80%95%E5%AE%9F%E7%B8%BE%E8%B1%8A%E5%AF%8C%E3%81%AA%E6%B4%BB%E7%94%A8%E4%BA%8B%E4%BE%8B%E3%81%A8%E3%83%8E%E3%82%A6%E3%83%8F%E3%82%A6%E3%81%A7%E5%AD%A6%E3%81%B6-%E6%97%A5%E7%AB%8B%E8%A3%BD%E4%BD%9C%E6%89%80-Generative-AI%E3%82%BB%E3%83%B3%E3%82%BF%E3%83%BC/dp/4865943986)
